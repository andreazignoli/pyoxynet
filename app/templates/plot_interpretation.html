<!DOCTYPE html>
<html>
<head lang="en">
    <link rel="stylesheet" type="text/css" href="static/styles.css">
    <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hello from Oxynet</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
</head>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disclaimer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
        }
        .disclaimer-container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 10px;
            background-color: #f9f9f9;
        }
        .disclaimer-text {
            margin-bottom: 20px;
            text-align: left;
        }
        body {
            /* Set background image */
            background-image: url('static/background_homepage.png');
            /* Specify background image size */
            background-size: cover;
            /* Center the background image */
            background-position: center;
            /* Add a background color as a fallback */
            background-color: #f8f8f8; /* Light gray */
            /* Set background to fixed so it doesn't scroll */
            background-attachment: fixed;
            /* Adjust background image opacity */
            opacity: 1;
        }
        .chart-container {
        border: 1px solid #ccc; /* Add border */
        border-radius: 10px; /* Add rounded corners */
        padding: 10px; /* Add padding */
        background-color: #f9f9f9; /* Add background color */
        margin-bottom: 20px; /* Add some space between charts */
    }
    </style>
</head>

<body>

<div class="container">
    {% if CPET_data.VT1.VO2 == 0 or CPET_data.VT2.VO2 == 0 %}
    <h2 style="color: #ff4444;">‚ö†Ô∏è Oxynet Could Not Detect Ventilatory Thresholds</h2>
    <div style="background-color: #ffe6e6; border: 2px solid #ff4444; border-radius: 10px; padding: 15px; margin: 20px auto; max-width: 600px; text-align: center;">
        <h3 style="color: #cc0000; margin-top: 0;">‚ùå INFERENCE FAILED - DO NOT TRUST THESE RESULTS</h3>
        <p style="color: #666; margin-bottom: 0;">
            Sorry, for some reasons üòî the OxyNet model could not reliably identify VT1 and/or VT2 thresholds in this test data. 
            This may be due to:
            <br>‚Ä¢ Poor data quality or noise
            <br>‚Ä¢ Irregular breathing patterns
            <br>‚Ä¢ Atypical physiological responses
            <br>‚Ä¢ Incomplete or truncated test protocol
            <br><br>
            <strong>Please manually review the gas exchange plots below and consider re-analyzing the test data.</strong>
        </p>
    </div>
    <ul>
        <h4 style="color: #999; text-decoration: line-through;">VT<sub>1</sub>: {{CPET_data.VT1.VO2}} mlO<sub>2</sub>/min ({{CPET_data.VT1.perc_VO2}} %VO<sub>2MAX</sub>)
        <br>VT<sub>2</sub>: {{CPET_data.VT2.VO2}} mlO<sub>2</sub>/min ({{CPET_data.VT2.perc_VO2}} %VO<sub>2MAX</sub>)</h4>
    </ul>
    {% else %}
    <h2>Oxynet just did some magic: here the results of the interpretation ü™Ñ</h2>
    <ul>
        <h4>VT<sub>1</sub>: {{CPET_data.VT1.VO2}} mlO<sub>2</sub>/min ({{CPET_data.VT1.perc_VO2}} %VO<sub>2MAX</sub>)
        <br>VT<sub>2</sub>: {{CPET_data.VT2.VO2}} mlO<sub>2</sub>/min ({{CPET_data.VT2.perc_VO2}} %VO<sub>2MAX</sub>)</h4>
    </ul>
    {% endif %}
</div>

<div class="row">
    <div class="column">
        <div class="chart-container">
            <div class="chart" id="plot_VCO2vsVO2" style="background-color: transparent;">
                <script>
                    var graphs = {{VCO2vsVO2 | safe}};
                    Plotly.plot('plot_VCO2vsVO2',graphs,{});
                </script>
            </div>
        </div>
    </div>
    <div class="column">
        <div class="chart-container">
            <div class="chart" id="plot_VEvsVCO2">
                <script>
                    var graphs = {{VEvsVO2 | safe}};
                    Plotly.plot('plot_VEvsVCO2',graphs,{});
                </script>
            </div>
        </div>
    </div>
    <div class="column">
        <div class="chart-container">
            <div class="chart" id="plot_VEVO2">
                <script>
                    var graphs = {{VEVO2 | safe}};
                    Plotly.plot('plot_VEVO2',graphs,{});
                </script>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="column">
        <div class="chart-container">
            <div class="chart" id="plot_PetO2">
                <script>
                    var graphs = {{PetO2 | safe}};
                    Plotly.plot('plot_PetO2',graphs,{});
                </script>
            </div>
        </div>
    </div>
    <div class="column">
        <div class="chart-container">
            <div class="chart" id="plot_PetCO2">
                <script>
                    var graphs = {{PetCO2 | safe}};
                    Plotly.plot('plot_PetCO2',graphs,{});
                </script>
            </div>
        </div>
    </div>
    <div class="column">
        <div class="chart-container">
            <div class="chart" id="plot_VEVCO2">
                <script>
                    var graphs = {{VEVCO2 | safe}};
                    Plotly.plot('plot_VEVCO2',graphs,{});
                </script>
            </div>
        </div>
    </div>
</div>

<!-- Probability Plots -->
<div style="text-align: center; margin: 30px 0;">
    <h3 style="color: #ff6b35; margin-bottom: 20px;">üß† Exercise Domain Probabilities vs Time</h3>
    <div class="chart-container" style="max-width: 800px; margin: 0 auto;">
        <div class="chart" id="plot_probabilities_time">
            <script>
                var graphs = {{probabilities_time_plot | safe}};
                Plotly.plot('plot_probabilities_time',graphs,{});
            </script>
        </div>
    </div>
    <p style="font-size: 14px; color: #666; margin-top: 10px;">
        <strong>Exercise Domain Classification:</strong> This plot shows the OxyNet model's confidence in classifying each moment of the test into three physiological exercise domains:
        <br>‚Ä¢ <span style="color: #2ecc71;"><strong>Moderate Domain (Green):</strong></span> Below VT1 - sustainable aerobic exercise where lactate remains stable
        <br>‚Ä¢ <span style="color: #f1c40f;"><strong>Heavy Domain (Yellow):</strong></span> Between VT1-VT2 - elevated but steady-state lactate levels
        <br>‚Ä¢ <span style="color: #e74c3c;"><strong>Severe Domain (Red):</strong></span> Above VT2 - progressive lactate accumulation leading to exhaustion
        <br><em>Probabilities represent the model's certainty (0-1) for each domain at every timepoint during the test.</em>
    </p>
</div>

<div style="text-align: center; margin: 30px 0;">
    <h3 style="color: #ff6b35; margin-bottom: 20px;">üß† Exercise Domain Classification: VO‚ÇÇ vs Time</h3>
    <div class="chart-container" style="max-width: 800px; margin: 0 auto;">
        <div class="chart" id="plot_probabilities_vo2">
            <script>
                var graphs = {{probabilities_vo2_plot | safe}};
                Plotly.plot('plot_probabilities_vo2',graphs,{});
            </script>
        </div>
    </div>
    <p style="font-size: 14px; color: #666; margin-top: 10px;">
        <strong>Domain-Based VO‚ÇÇ Progression:</strong> Each point represents VO‚ÇÇ over time, colored by the <em>most probable</em> exercise domain:
        <br>‚Ä¢ <span style="color: #2ecc71;"><strong>Green points:</strong></span> Moderate domain (sustainable aerobic metabolism)
        <br>‚Ä¢ <span style="color: #f1c40f;"><strong>Yellow points:</strong></span> Heavy domain (elevated lactate steady-state)
        <br>‚Ä¢ <span style="color: #e74c3c;"><strong>Red points:</strong></span> Severe domain (lactate accumulation, limited duration)
        <br><em>Point color reflects the domain with highest probability at that moment. Horizontal lines show VO‚ÇÇ at ventilatory thresholds.</em>
    </p>
</div>

<!-- Conditional Load vs Time Plot -->
{% if show_load_plot %}
<div style="text-align: center; margin: 30px 0;">
    <h3 style="color: #ff6b35; margin-bottom: 20px;">üî• Load vs Time Analysis</h3>
    <div class="chart-container" style="max-width: 800px; margin: 0 auto;">
        <div class="chart" id="plot_load">
            <script>
                var graphs = {{load_plot | safe}};
                Plotly.plot('plot_load',graphs,{});
            </script>
        </div>
    </div>
    <p style="font-size: 14px; color: #666; margin-top: 10px;">
        Load progression (orange) and gas exchange (VO‚ÇÇ in soft blue, VCO‚ÇÇ in soft red) during CPET with ventilatory thresholds marked.
    </p>
</div>
{% endif %}

<!-- Conditional Substrate Utilization Plots -->
{% if show_fat_plot %}
<div style="text-align: center; margin: 30px 0;">
    <h3 style="color: #ff6b35; margin-bottom: 20px;">üî• Substrate Utilization vs Load</h3>
    <div class="chart-container" style="max-width: 800px; margin: 0 auto;">
        <div class="chart" id="plot_fat_oxidation">
            <script>
                var graphs = {{fat_oxidation_plot | safe}};
                Plotly.plot('plot_fat_oxidation',graphs,{});
            </script>
        </div>
    </div>
    <p style="font-size: 14px; color: #666; margin-top: 10px;">
        Fat oxidation rate (orange) and carbohydrate consumption rate (green) at different load levels.
        Each point represents the average of 60 samples before load changes during steady-state periods.
    </p>
</div>

<div style="text-align: center; margin: 30px 0;">
    <h3 style="color: #ff6b35; margin-bottom: 20px;">üî• Substrate Utilization vs % VO‚ÇÇmax (‚ö†Ô∏è ONLY FOR VALID VO‚ÇÇmax TESTS)</h3>
    <div class="chart-container" style="max-width: 800px; margin: 0 auto;">
        <div class="chart" id="plot_substrate_vo2max">
            <script>
                var graphs = {{substrate_vo2max_plot | safe}};
                Plotly.plot('plot_substrate_vo2max',graphs,{});
            </script>
        </div>
    </div>
    <p style="font-size: 14px; color: #666; margin-top: 10px;">
        Fat oxidation rate (orange) and carbohydrate consumption rate (green) as function of relative exercise intensity.
        Data points fitted with 3rd degree polynomials (y-intercept = 0) to model substrate utilization curves.
        VO‚ÇÇmax calculated as maximum 20-second rolling average during the test.
    </p>
</div>
{% endif %}

<!-- Conditional Energy Contribution Plots -->
{% if show_energy_plot %}
<div style="text-align: center; margin: 30px 0;">
    <h3 style="color: #ff6b35; margin-bottom: 20px;">üî• Energy Contribution vs Load</h3>
    <div class="chart-container" style="max-width: 800px; margin: 0 auto;">
        <div class="chart" id="plot_energy_contribution_load">
            <script>
                var graphs = {{energy_contribution_load_plot | safe}};
                Plotly.plot('plot_energy_contribution_load',graphs,{});
            </script>
        </div>
    </div>
    <p style="font-size: 14px; color: #666; margin-top: 10px;">
        Percentage of energy expenditure from fat (orange) and carbohydrate (green) at different load levels.
        Total energy contribution always equals 100%.
    </p>
</div>

<div style="text-align: center; margin: 30px 0;">
    <h3 style="color: #ff6b35; margin-bottom: 20px;">üî• Energy Contribution vs % VO‚ÇÇmax (‚ö†Ô∏è ONLY FOR VALID VO‚ÇÇmax TESTS)</h3>
    <div class="chart-container" style="max-width: 800px; margin: 0 auto;">
        <div class="chart" id="plot_energy_contribution_vo2max">
            <script>
                var graphs = {{energy_contribution_vo2max_plot | safe}};
                Plotly.plot('plot_energy_contribution_vo2max',graphs,{});
            </script>
        </div>
    </div>
    <p style="font-size: 14px; color: #666; margin-top: 10px;">
        Percentage of energy expenditure from fat (orange) and carbohydrate (green) as function of relative exercise intensity.
        Data points fitted with 3rd degree polynomials to model energy contribution curves.
        VO‚ÇÇmax calculated as maximum 20-second rolling average during the test.
    </p>
</div>
{% endif %}

<body>
    <form action="/">
        <input type="submit" value="Analyse another test" name="back_home" id="submit_BACK_HOME" class="button_1"/>
    </form>
</body>

<hr class="bottom-line">

<div class="disclaimer-container">
    <h2>Disclaimer</h2>
    <p class="disclaimer-text">All content found on this website, including: text, images, tables, or other formats are created for informational purposes only. The information provided by this software is not intended to be a substitute for professional medical advice, diagnosis, or treatment. Always seek the advice of your physician or other qualified health provider with any questions you may have regarding a medical condition. Never disregard professional medical advice or delay in seeking it because of something has been provided by this software.</p>
    <p class="disclaimer-text">Publication: If this software is adding value to your research, please cite: Oxynet: a collective intelligence that detects ventilatory thresholds in cardiopulmonary exercise tests, Zignoli et al., European Journal of Sport Science, 2020, <a href="https://doi.org/10.1080/17461391.2020.1866081">DOI: 10.1080/17461391.2020.1866081</a>.</p>
    <p class="disclaimer-text">Contribute: If you think you can contribute to the project as an expert in cardiopulmonary exercising testing please email: <a href="mailto:andrea.zignoli@unitn.it">üìß andrea.zignoli@unitn.it</a>.</p>
</div>
</div>

<footer style="text-align: center; font-size: small;">
    Photo by <a href="https://unsplash.com/@pawel_czerwinski?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash">Pawel Czerwinski</a> on <a href="https://unsplash.com/photos/a-white-background-with-pink-and-blue-paint-OG44d93iNJk?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash">Unsplash</a>
</footer>

</body>
</html>